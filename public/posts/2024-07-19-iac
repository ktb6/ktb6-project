---
title: 'IaC (Infrastructure as Code)'
date: '2024-07-19'
author: 'Ari.Byun'
description: 'Ansible, Terraform 등 주요 IaC 도구들 소개'

category: 'Blog'
image: ''
tags: ['IaC','Ansible','Terraform']
---

# Infrastructure As Code
서버, 네트워크, 데이터베이스, 애플리케이션 구성 등 인프라를 코드로 정의하고 자동으로 배포 및 관리하는 방식.
* 선언적 접근 방식
원하는 최종 상태를 정의하면 시스템이 자동으로 구성 (ex Terraform)
* 명령적 접근 방식
사용자가 수행할 명령을 단계별로 작성 (ex Ansible)

## Terraform
주로 클라우드 인프라를 설정하고 관리하는 데 사용

### 구성 요소
* Providers: 클라우드 서비스 제공자와의 인터페이스
ex. `provider "aws" { region = "ap-northeast-2" }`
* Resources: 클라우드 자원을 정의
ex. `resource "aws_instance" "example" { ami = "ami-123456" instance_type = "t2.micro" }`
* Variables: 변수 사용을 통해 코드 재사용성 증가
ex. `variable "region" { default = "ap-northeast-2" }`
* Outputs: 출력 값을 정의하여 다른 구성 요소와 연계
ex. `output "instance_ip" { value = aws_instance.example.public_ip }`
* Modules: 코드의 재사용을 위해 모듈화
ex. `module "vpc" { source = "./modules/vpc" }`

### 워크플로우
terraform init (초기화) - 프로젝트 디렉토리를 초기화하고 필요한 플러그인을 다운로드 
terraform plan (계획 수립) - 변경 사항을 시뮬레이션하고 계획서 출력
terraform apply (적용) - 계획된 변경 사항을 실제 인프라에 적용
terraform state (상태 관리) - 현재 인프라 상태 확인 및 관리
terraform destroy (종료) - 인프라 자원을 제거

## Ansible
서버 구성, 애플리케이션 배포, 시스템 오케스트레이션 등을 자동화하는 데 사용

### 구성 요소
* Inventory: 관리할 호스트 목록을 정의 ex. hosts.ini
* Playbooks: 작업 정의서로, YAML 포맷 사용 ex. site.yml
* Modules: 특정 작업을 수행하는 코드 블록 ex. ansible.builtin.shell
* Roles: 관련 작업을 그룹화하여 재사용 가능 ex. roles/web
* Tasks: 실행할 작업을 정의 ex. tasks/main.yml
* Handlers: 특정 조건에 따라 실행되는 작업 ex. handlers/main.yml
* Templates: Jinja2 템플릿을 통해 설정 파일 생성 ex. templates/nginx.conf.j2

### 워크플로우
* 인벤토리 설정
```
// hosts.ini
[webservers]
web1.example.com
web2.example.com

[databases]
db1.example.com

```
* 플레이북 작성
```
// site.yml
---
- name: Configure web servers
  hosts: webservers
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present

    - name: Start Nginx service
      service:
        name: nginx
        state: started
```
* 플레이북 실행
```
ansible-playbook -i hosts site.yml
```
* 상태 확인


# 프로젝트 활용 방안
AWS EC2 인스턴스, S3 버킷, EBS 볼륨 등 클라우드 리소스를 이용할 때 IaC 도구로 환경 구성
